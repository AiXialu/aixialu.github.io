---
title: http-socket-websocket
date: 2020-08-06 18:37:32
tags:
---

## HTTP Socket WebSocket

简单地说

1. TCP/IP 协议，是网络七层协议的第四层，本身没有长连接或短连接的区别；
2. HTTP 是基于 TCP 协议之上的「短连接」应用层协议，它的出现极大简化了网络应用的实现门槛，丰富了应用；
3. Socket 是操作系统内置的一套操作 TCP/IP 协议的网络（套接字）的方法；
4. Websocket 是跟 HTTP 对应的，基于 TCP 协议之上的「长连接」协议。

### Socket VS  Websocket

- Socker

Socket是一套API接口，是建立在TCP和应用程序之间的一个抽象层，就是我们之前说的“面向抽象编程”的这个抽象，Socket这个抽象层帮我们封装了TCP/UDP等网络协议的操作，让我们可以通过Socket提供的接口进行网络通信，可以通过一个图来说明这个抽象的功能

![](https://camo.githubusercontent.com/c210f99ddd91ad1fc356be0fe5818400eace1eb6/68747470733a2f2f7777772e6769746875622e636f6d2f6c616e7975616e7869616f79616f2f47697447616c6c6572792f7261772f6d61737465722f323031372f372f32322f254534254238254241254534254242253830254534254239253838254534254238253844254537253942254234254536253845254135254534254244254246254537253934254138736f636b65742532302c254538254246253938254538254136253831254535254145253941254534254239253839254534254238253830254534254238254141254536253936254230254537253941253834776562736f636b65742532302545372539412538342545352539312541322545462542432539462f30353232353732332d32666661383961616439316634363039396166613533306566383636306232302e6a7067)

![](https://camo.githubusercontent.com/20e360d7dc95b9496692bb90c737a2891823140a/68747470733a2f2f7777772e6769746875622e636f6d2f6c616e7975616e7869616f79616f2f47697447616c6c6572792f7261772f6d61737465722f323031372f372f32322f254534254238254241254534254242253830254534254239253838254534254238253844254537253942254234254536253845254135254534254244254246254537253934254138736f636b65742532302c254538254246253938254538254136253831254535254145253941254534254239253839254534254238253830254534254238254141254536253936254230254537253941253834776562736f636b65742532302545372539412538342545352539312541322545462542432539462f30353233323333352d66623139666337353237653934346434383435656634303833316461346563322e706e67)

### HTTP VS WebSocket

- WebSocket常见于客户端-服务端全双工的场景，客户端可以发送消息给服务端，同时服务端也可以主动发送消息给客户端。
- 而Http是单向的关系。只能客户端发送请求，服务端被动接收，服务端没有主动发起对话的能力。

不过WebSocket并不普及。完整的WebSocket通信，需要客户端（浏览器）、服务端、网关节点、防火墙等一套的支持。尤其对于面向用户的环境来说，用户使用的浏览器、用户所处的网络环境，都是不能控制的。这种情况下建议不要使用WebSocket。

![](https://camo.githubusercontent.com/ac29fc3c7576339c0a67ad35b10351ce4789a6d5/68747470733a2f2f7777772e6769746875622e636f6d2f6c616e7975616e7869616f79616f2f47697447616c6c6572792f7261772f6d61737465722f323031372f372f32322f254534254238254241254534254242253830254534254239253838254534254238253844254537253942254234254536253845254135254534254244254246254537253934254138736f636b65742532302c254538254246253938254538254136253831254535254145253941254534254239253839254534254238253830254534254238254141254536253936254230254537253941253834776562736f636b65742532302545372539412538342545352539312541322545462542432539462f6267323031373035313530322e706e67)

---

>为什么在 HTTP 存在的很长一段时间都没有出现标准的「长连接」协议呢？

答：因为直接基于 TCP 的握手协议根本不分长短连接，所以你可以理解成天生就是长连接。所以很早就有基于长连接的「聊天协议」专门用于聊天等碎片化信息交换场景（例如 IRC、XMPP）。随着 WWW（万维网）被发明出来，需要一个交换丰富表达形式的方式，来表达一些中等长度的内容展现。与 IRC 那种 为少数人之间传递碎片信息的协议不一样，WWW 被设计成 1对上万人甚至数十万人传递信息，所以需要一个能节省「连接维系成本」的协议，它需要在用户看完这篇内容后，断开连接，以给其他人再查看这篇内容，于是就出现了 HTTP 短连接协议。所以，并不是在 HTTP 之前没有 长连接协议，只是他们在当时应用场景范围不大。

>问：QQ、微信基于的都是 IRC 协议吗？

答：不是，QQ、微信基于自己的私有通信协议，为什么呢？因为聊天是碎片化的实时行为，场景是高频地进行网络交换。所以这种情况下，节省 TCP 的握手次数、节省协议本身的网络消耗就显得非常重要。所以大型 IM 软件都基于私有协议（有自己的服务端、客户端），这样能最大化精简交换信息时消耗的网络资，而 HTTP 的特点是「每进行一次网络交换，都能传送一篇长文，供读者读好一段时间」，并非高频交换，所以从协议设计的角度来讲，「统一性、功能性」比「简洁性」更重要）。

>问：为什么再需要 Websocket，而不能直接使用以前的 IRC或 XMPP 呢？

答：因为 浏览器是基于 HTTP 的标准客户端，而且 HTTP 协议发展到今天在各个方面已经非常成熟，所以最大程度复用是合理的。

>问：QQ、微信 会改成 Websocket 协议吗？

答：Web 版本可能会，但客户端版本很大概率不会。原因很简单，就是前面说的，公用协议臃肿，既然有自己的客户端，为什么不自己设计协议。但很多创业产品，应该会直接使用 Websocket 来 startup，因为普及，所以开发门槛低。

>问：既然 Websocket 臃肿，为什么各个产品不在 Web 里使用私有协议？

答：因为整个浏览器都不支持直接调用系统底层的 Socket，基于浏览器的 Web 自然无法调用，只能使用封装的高级协议方案 —— Websocket。